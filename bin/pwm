#!/bin/bash

PWM=`cat /sys/class/pwm/pwmchip0/pwm0/duty_cycle`
if [ "$1" == "init" ] ; then
  #need sudo!
  gpio -g mode 12 pwm
  chown -R root:gpio /sys/class/pwm && chmod -R 770 /sys/class/pwm
  chown -R root:gpio /sys/devices/platform/soc/*.pwm/pwm/pwmchip*
  chmod -R 770 /sys/devices/platform/soc/*.pwm/pwm/pwmchip*
  echo 0 > /sys/class/pwm/pwmchip0/export
	echo 1000 > /sys/class/pwm/pwmchip0/pwm0/period
  PWM=600
  echo $PWM > /sys/class/pwm/pwmchip0/pwm0/duty_cycle
  echo 1 > /sys/class/pwm/pwmchip0/pwm0/enable
elif [ "$1" == "-" ] ; then
	if [ $PWM -lt 500 ] ; then
		PWM=$[$PWM + 100]
	elif [ $PWM -lt 1000 ] ; then
		PWM=$[$PWM + 50]
	fi
elif [ "$1" == "+" ] ; then
	if [ $PWM -ge 550 ] ; then
		PWM=$[$PWM - 50]
	elif [ $PWM -ge 100 ] ; then
		PWM=$[$PWM - 100]
	fi
fi
echo PWM duty: $PWM of 1000
echo $PWM > /sys/class/pwm/pwmchip0/pwm0/duty_cycle


